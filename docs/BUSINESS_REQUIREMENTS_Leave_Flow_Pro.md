# Business Requirements Document (BRD)
## ระบบ Leave Flow Pro v1.0.0

**เวอร์ชันเอกสาร:** 1.0  
**เวอร์ชันระบบ:** 1.0.0  
**ภาษา:** ไทย  
**หน่วยงาน:** CONNEX Business Online Co., Ltd.

---

## 1. ภาพรวมระบบ

Leave Flow Pro เป็นระบบบริหารการลาของพนักงานแบบหลายผู้ใช้ รองรับการล็อกอินตามบทบาท (พนักงาน / ผู้จัดการ / ผู้ดูแลระบบ) การยื่นคำขอลา การอนุมัติ/ไม่อนุมัติโดยผู้บังคับบัญชา การลงเวลาประจำวัน การจัดการวันหยุดและประเภทวันลา รวมถึงรายงานสรุปการลาและมุมมองปฏิทินตามสายบังคับบัญชา

---

## 2. วัตถุประสงค์ทางธุรกิจ

- ให้พนักงานยื่นคำขอลาออนไลน์และติดตามสถานะได้
- ให้ผู้จัดการ/ผู้ดูแลระบบอนุมัติหรือไม่อนุมัติคำขอ พร้อมใส่ความเห็นแจ้งพนักงาน
- แสดงโควต้าวันลาตามประเภท (ลาป่วย ลาพักร้อน ลากิจ ฯลฯ) และหักใช้เมื่อมีการลาที่อนุมัติแล้ว
- รองรับการลงเวลาเข้า–ออก และการหักโควต้าลาพักร้อนเมื่อมาสาย (ตามกฎที่กำหนด)
- ให้ผู้จัดการเห็นรายงานประวัติการลาและสรุปวันลาของพนักงานในสังกัด (รวม Pivot และมุมมองปฏิทิน)
- จัดการข้อมูลหลัก (พนักงาน ประเภทวันลา วันหยุดบริษัท) สำหรับผู้ดูแลระบบ

---

## 3. บทบาทผู้ใช้ (User Roles)

| บทบาท | คำอธิบาย | สิทธิ์หลัก |
|--------|----------|------------|
| **พนักงาน (EMPLOYEE)** | พนักงานทั่วไป | ยื่นคำขอลา ดูโควต้า ลงเวลา ดูประวัติการลา/การลงเวลาของตนเอง ดูสมุดลาพักร้อน |
| **ผู้จัดการ (MANAGER)** | มีลูกทีมในสายบังคับบัญชา | ทุกอย่างของพนักงาน + อนุมัติ/ไม่อนุมัติคำขอของลูกทีม ดูรายงานประวัติการลาและสรุปวันลาของพนักงานในสังกัด (รายการ/ปฏิทิน/Pivot) ดูการลงเวลาของทีม |
| **ผู้ดูแลระบบ (ADMIN)** | จัดการระบบและข้อมูลหลัก | ทุกอย่างของผู้จัดการ + จัดการรายชื่อและสิทธิพนักงาน (เพิ่ม/แก้/ลบ กำหนดผู้บังคับบัญชา บทบาท โควต้า) จัดการประเภทวันลา จัดการวันหยุดบริษัท ดูคำขอลาทั้งหมดและอนุมัติได้ทุกคน |

---

## 4. ฟังก์ชันหลัก (Functional Requirements)

### 4.1 การเข้าสู่ระบบ (Login)

- ใช้ อีเมล + รหัสผ่าน ล็อกอิน
- หลังล็อกอินระบบกำหนดบทบาทและแสดงเมนู/ฟีเจอร์ตามบทบาท
- มีการยืนยันก่อนออกจากระบบ
- ข้อความแจ้งเตือน/ยืนยันใช้หัวข้อ "Leave Flow Pro says" (ไม่ใช้ข้อความจาก browser มาตรฐาน)

### 4.2 แดชบอร์ด (Dashboard)

- แสดงโควต้าวันลาของผู้ใช้ (คงเหลือ / ใช้ไปแล้ว) แยกตามประเภทวันลา
- โดยค่าเริ่มต้นแสดงเฉพาะ ลาป่วย ลาพักร้อน ลากิจ มีลิงก์ "ดูทุกประเภทวันลา" เพื่อแสดงประเภทอื่น
- โควต้าที่ใช้ไปนับรวมทั้งสถานะรออนุมัติและอนุมัติแล้ว (แสดงแยกป้าย "อนุมัติแล้ว" / "รออนุมัติ" ตามที่กำหนด)
- ผู้จัดการ/แอดมิน: แสดงบล็อก "คำขอที่รอการอนุมัติ" และจำนวนรายการ

### 4.3 การยื่นคำขอลา (Leave Request)

- พนักงานเลือกประเภทวันลา วันที่เริ่ม–สิ้นสุด เหตุผล แล้วส่งคำขอ
- ระบบคำนวณจำนวนวันทำการ (ไม่นับเสาร์–อาทิตย์และวันหยุดบริษัท) แสดงให้ผู้ยื่นเห็น
- ต้องไม่สามารถเลือกวันลาที่เป็นวันหยุด (เสาร์ อาทิตย์ หรือวันหยุดบริษัท) เป็นวันลาได้ (ตามกฎที่กำหนด)
- หลังส่ง จะแสดงใน "คำขอที่รอการอนุมัติ" ของผู้บังคับบัญชา/แอดมิน
- แสดงวันที่และเวลาที่พนักงานทำรายการ (ส่งเมื่อ) ในคำขอที่รอการอนุมัติ (เวลาไทย UTC+7)

### 4.4 คำขอที่รอการอนุมัติ (Approval Board)

- ผู้จัดการเห็นเฉพาะคำขอของลูกทีมในสายบังคับบัญชา แอดมินเห็นทุกคำขอที่สถานะรออนุมัติ
- แสดงรายละเอียด: ชื่อพนักงาน ประเภทวันลา จำนวนวันทำการ ระยะเวลา เหตุผล วันที่ส่ง
- ผู้จัดการ/แอดมินสามารถ อนุมัติ หรือ ไม่อนุมัติ พร้อมใส่ความเห็นเพิ่มเติมเพื่อแจ้งพนักงาน
- หลังอนุมัติ/ไม่อนุมัติ ระบบอัปเดตสถานะและหักโควต้า (เมื่ออนุมัติ) ตามประเภทวันลา

### 4.5 การลงเวลา (Attendance)

- พนักงานลงเวลาเข้า (Check-in) และออก (Check-out) ได้ตามวัน
- ถ้าเข้างานหลัง 09:30 น. ระบบถือว่าสาย และอาจหักโควต้าลาพักร้อน (เช่น 0.25 วัน) ตามกฎที่กำหนด และสร้างการแจ้งเตือนให้พนักงานและผู้จัดการ
- มีโมดูลแสดงประวัติการลงเวลาของตนเอง และ (สำหรับผู้จัดการ) การลงเวลาของทีม

### 4.6 รายงานและประวัติ (Reports & History)

- **รายงานประวัติการลาของพนักงานในสังกัด:** มุมมองรายการ และมุมมองปฏิทินรายเดือน มีตัวกรองค้นหาชื่อพนักงาน (ผู้จัดการเห็นเฉพาะลูกทีม แอดมินเห็นทั้งหมด)
- **รายงานสรุปวันลาของพนักงานในสังกัด (Pivot):** ตารางสรุปวันลาตามพนักงาน/ประเภท เรียงจากคนที่ลามากที่สุดก่อน มีเงื่อนไขค้นหา: ระบุเดือนและปี หรือทั้งปี
- **สมุดลาพักร้อน (Vacation Ledger):** แสดงประวัติการใช้ลาพักร้อน (ยื่น อนุมัติ/ไม่อนุมัติ)
- รองรับการสรุปด้วย AI (Gemini) สำหรับผู้จัดการ เมื่อตั้งค่า API Key แล้ว

### 4.7 การจัดการข้อมูลหลัก (Admin)

- **รายชื่อและสิทธิพนักงาน:** เพิ่ม/แก้ไข/ลบพนักงาน กำหนดชื่อ อีเมล รหัสผ่าน บทบาท เพศ แผนก วันที่เริ่มงาน ผู้บังคับบัญชา โควต้าวันลาตามประเภท หลังแก้ไข (เช่น เปลี่ยนผู้บังคับบัญชา) หน้าจอต้องรีเฟรชข้อมูลให้เป็นปัจจุบัน
- **จัดการประเภทวันลา:** เพิ่ม/แก้ไข/ลบประเภทวันลา (รหัส ชื่อ ใช้กับเพศ โควต้า default ลำดับ สถานะ) แต่ละประเภทมีได้หนึ่งรายการ (ไม่ซ้ำ) แก้ไขแล้วต้องบันทึกลงฐานข้อมูลและรีเฟรชหน้าจอ
- **จัดการวันหยุดบริษัท:** กำหนดวันหยุดประจำปี (วันที่ + ชื่อวันหยุด) สำหรับใช้คำนวณวันทำการและปิดการเลือกเป็นวันลา
- การลบพนักงานใช้กล่องยืนยันของระบบ (Leave Flow Pro says) ไม่ใช้ข้อความจาก browser

### 4.8 การแจ้งเตือน (Notifications)

- แจ้งเตือนเมื่อมีการอนุมัติ/ไม่อนุมัติคำขอ หรือเมื่อมีการหักโควต้าเพราะมาสาย เป็นต้น
- แสดงในศูนย์แจ้งเตือนและสามารถทำเครื่องหมายว่าอ่านแล้ว

### 4.9 ข้อกำหนดอื่นของระบบ

- **ลิขสิทธิ์:** ทุกหน้าต้องมีข้อความ footnote "ลิขสิทธิ์ของระบบ เป็นของ CONNEX Business Online Co., Ltd."
- **โลโก้และชื่อแอป:** ใช้โลโก้ CONNEX และชื่อ "Leave Flow Pro" ในหน้าเข้าสู่ระบบและในแอป (ไม่แสดง "HR Leave Flow" ในหน้า Login)
- **เวลา:** ค่าที่เก็บในฐานข้อมูลเป็น UTC (ช้ากว่าเวลาไทย 7 ชั่วโมง) การแสดงผลวันที่/เวลาบนหน้าจอใช้เวลาไทย (UTC+7)

---

## 5. กฎธุรกิจหลัก (Business Rules)

- วันทำการ = วันที่ไม่ใช่วันเสาร์、วันอาทิตย์ และไม่ใช่วันหยุดบริษัท
- โควต้าวันลาหักเมื่อคำขอลามีสถานะอนุมัติแล้ว (และตามกฎการหักเมื่อมาสายสำหรับลาพักร้อน)
- ผู้จัดการอนุมัติได้เฉพาะคำขอของพนักงานที่อยู่ในสายบังคับบัญชาของตนเอง (ตาม managerId / โครงสร้างองค์กร)
- แอดมินอนุมัติได้ทุกคำขอและจัดการข้อมูลหลักได้ทั้งหมด
- ประเภทวันลาอาจกำหนดให้ใช้กับเพศชาย/หญิง/ทั้งสอง และมีโควต้า default ต่อปี (เช่น 999 = ไม่จำกัด)
- รหัสผ่านต้องไม่เก็บเป็น plain text; ระบบต้อง hash ก่อนบันทึก และรองรับการเปลี่ยนรหัสผ่านแล้วล็อกอินได้

---

## 6. ข้อมูลหลัก (Data Entities)

- **ผู้ใช้ (User):** รหัส ชื่อ อีเมล รหัสผ่าน (hash) บทบาท เพศ แผนก วันที่เริ่มงาน ผู้บังคับบัญชา โควต้าวันลาตามประเภท
- **คำขอลา (Leave Request):** รหัส ผู้ยื่น ประเภทวันลา วันที่เริ่ม–สิ้นสุด เหตุผล สถานะ (รออนุมัติ/อนุมัติแล้ว/ไม่อนุมัติ) วันที่ส่ง วันที่ตรวจสอบ ความเห็นผู้ตรวจ
- **ประเภทวันลา (Leave Type):** รหัส ชื่อ ใช้กับเพศ โควต้า default ลำดับ สถานะ
- **วันหยุด (Holiday):** วันที่ ชื่อวันหยุด
- **การลงเวลา (Attendance):** รหัส ผู้ใช้ วันที่ เวลาเข้า เวลาออก สายหรือไม่ การหักโควต้า
- **การแจ้งเตือน (Notification):** รหัส ผู้รับ หัวข้อ ข้อความ สถานะการอ่าน วันที่สร้าง

---

## 7. สรุป

เอกสารฉบับนี้อธิบายความต้องการทางธุรกิจของระบบ Leave Flow Pro สำหรับใช้เป็นฐานในการพัฒนาต่อ การทดสอบการยอมรับ (UAT) และการจัดทำคู่มือการใช้งาน โดยฟีเจอร์และกฎธุรกิจอาจปรับเพิ่มตามนโยบายบริษัทและข้อกำหนดด้านความปลอดภัย (เช่น OWASP) ได้
